# This is an apache config file included in NextCloud vhosts.
# It adds CILogon as an openid connect authn provider.

OIDCProviderMetadataURL https://cilogon.org/.well-known/openid-configuration
OIDCClientID <%= @oidc_client_id %>
OIDCClientSecret <%= @oidc_client_secret %>

OIDCRedirectURI https://<%= @fqdn %>/oauth_callback
OIDCCryptoPassphrase <%= @oidc_crypto_passphrase %>
OIDCScope "openid email org.cilogon.userinfo profile"

# Everything but webdav needs to be authenticated with CILogon.
<LocationMatch "^/(?!remote\.php/webdav).*$">
  AuthType openid-connect
  Require valid-user
</LocationMatch>


# This is a total sin from an organizational standpoint, but in a time crunch...
<FilesMatch \.php$>
    SetHandler application/x-httpd-php
</FilesMatch>
